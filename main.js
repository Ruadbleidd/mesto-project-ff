(()=>{"use strict";function t(t){document.addEventListener("keydown",r),t.classList.add("popup_is-opened")}function e(t){document.removeEventListener("keydown",r),t.classList.remove("popup_is-opened")}function n(t){t.target===t.currentTarget&&e(t.currentTarget)}function r(t){"Escape"===t.key&&e(document.querySelector(".popup_is-opened"))}function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function c(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?r:n}function i(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";n.preventDefault();var o=n.target.closest(".popup_is-opened"),i=n.submitter,u=i.textContent;return c(!0,i,u,r),t().then((function(){n.target.reset(),e(o)})).catch((function(t){console.error("Ошибка: ".concat(t))})).finally((function(){c(!1,i,u)}))}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function l(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return(e=function(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d={authorization:"6854f039-1743-430f-9824-0ce1c546e773","Content-Type":"application/json"},p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="".concat("https://nomoreparties.co/v1/wff-cohort-21").concat(t),r=l(l({},d),e.headers);return fetch(n,l(l({},e),{},{headers:r})).then(o)},f=function(t){return p("/cards/likes/".concat(t),{method:"PUT"})},m=function(t){return p("/cards/likes/".concat(t),{method:"DELETE"})};function y(t,e,n){var r=function(t){return{likeButton:t.querySelector(".card__like-button"),likeCounter:t.querySelector(".card__like-number")}}(t),o=r.likeButton,c=r.likeCounter;n?m(e).then((function(t){o.classList.remove("card__like-button_is-active"),c.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при удалении лайка: ".concat(t))})):f(e).then((function(t){o.classList.add("card__like-button_is-active"),c.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при добавлении лайка: ".concat(t))}))}var v=function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(validationConfig.inputErrorClass),n.classList.remove(validationConfig.errorClass),n.textContent="",e.setCustomValidity("")},_=function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?v(t,e):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(validationConfig.inputErrorClass),r.textContent=n,r.classList.add(validationConfig.errorClass)}(t,e,e.validationMessage)},b=function(t){t.disabled=!0,t.classList.add(validationConfig.inactiveButtonClass)},h=function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t){t.disabled=!1,t.classList.remove(validationConfig.inactiveButtonClass)}(e):b(e)};function S(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(e){v(t,e)}));var r=t.querySelector(e.submitButtonSelector);h(n,r)}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var C,q={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},E=null,k=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),O=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_update-avatar"),P=document.querySelector(".popup_type_question"),w=document.querySelector(".popup_type_new-card"),A=document.querySelector(".popup_type_image"),x=document.querySelector(".popup__form_type_update-avatar"),D=document.querySelector(".popup__image"),T=document.querySelector(".popup__caption"),B=document.querySelector(".popup__input_type_card-name"),I=document.querySelector(".popup__input_type_url"),U=document.querySelector(".profile__image"),M=document.querySelector(".profile__title"),N=document.querySelector(".profile__description"),H=document.forms.profileEdit,J=document.forms.newplace,V=H.querySelector(".popup__input_type_name"),R=H.querySelector(".popup__input_type_description"),Z=document.querySelector(".popup__input_type_update-avatar"),z=document.querySelector(".places__list");function W(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"prepend";t.forEach((function(t){var r=function(t){var e=t.img,n=t.title,r=t.functionDelCard,o=t.handleLikeCard,c=t.handlerOpenPopupZoom,i=t.cardData,u=t.currentUserId,a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=a.querySelector(".card__delete-button"),s=a.querySelector(".card__like-button"),d=a.querySelector(".card__image"),p=a.querySelector(".card__title"),f=a.querySelector(".card__like-number");return d.src=e,d.alt=n,p.textContent=n,f.textContent=i.likes.length,i.likes.some((function(t){return t._id===u}))&&s.classList.add("card__like-button_is-active"),i.owner._id!==u?l.remove():l.addEventListener("click",(function(){return r(a,i._id)})),s.addEventListener("click",(function(){var t=s.classList.contains("card__like-button_is-active");o(a,i._id,t)})),d.addEventListener("click",c),a}({img:t.link,title:t.name,functionDelCard:F,handleLikeCard:y,handlerOpenPopupZoom:$,cardData:t,currentUserId:e});z[n](r)}))}function $(e){var n,r,o=e.target,c=o.closest(".card").querySelector(".card__title").textContent;n=o.src,r=c,D.src=n,D.alt=r,T.textContent=r,t(A)}function F(e,n){E={element:e,id:n},t(P)}Promise.all([p("/users/me").then((function(t){return console.log(t),t})),p("/cards").then((function(t){return console.log(t),t}))]).then((function(t){var e,n,r,o,c,i=(c=2,function(t){if(Array.isArray(t))return t}(o=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,i,u=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=c.call(n)).done)&&(u.push(r.value),u.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(o,c)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(o,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],a=i[1],l=u._id;e=u.name,n=u.about,r=u.avatar,M.textContent=e,N.textContent=n,U.style.backgroundImage="url('".concat(r,"')"),W(a,l,"append")})).catch((function(t){console.log(t)})),k.addEventListener("click",(function(){var e=O.querySelector(".popup__button");b(e),V.value=M.textContent,R.value=N.textContent,S(H,q),t(O)})),U.addEventListener("click",(function(){return t(j)})),L.addEventListener("click",(function(){I.value="",B.value="",S(J,q),t(w)})),J.addEventListener("submit",(function(t){i((function(){var t=I.value;return function(t,e){return p("/cards",{method:"POST",body:JSON.stringify({name:t,link:e})})}(B.value,t).then((function(t){W([t],t.owner._id,"prepend")}))}),t)})),H.addEventListener("submit",(function(t){i((function(){return(t=V.value,e=R.value,p("/users/me",{method:"PATCH",body:JSON.stringify({name:t,about:e})}).then((function(t){return console.log("Профиль обновлен:",t),t}))).then((function(t){M.textContent=t.name,N.textContent=t.about}));var t,e}),t)})),C=document.querySelectorAll(".popup"),document.querySelectorAll(".popup__close").forEach((function(t,n){t.addEventListener("click",(function(){e(C[n])}))})),Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.addEventListener("mousedown",n)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);h(n,r),n.forEach((function(e){e.addEventListener("input",(function(){_(t,e),h(n,r)}))}))}(e,t)}))}(q),P.addEventListener("submit",(function(t){var n;t.preventDefault(),E&&(n=E.id,p("/cards/".concat(n),{method:"DELETE"})).then((function(){E.element.remove(),e(P)})).catch((function(t){console.error("Ошибка при удалении карточки: ".concat(t))}))})),x.addEventListener("submit",(function(t){i((function(){var t,e=Z.value;return(t=e,fetch(t,{method:"HEAD"}).then((function(t){if(!t.ok)return Promise.reject({status:t.status,message:"Ошибка: ".concat(t.statusText)});var e=t.headers.get("Content-Type");return!(!e||!e.startsWith("image/"))||Promise.reject("Ошибка: Это не URL изображения.")})).catch((function(t){return console.error("Error:",t),Promise.reject(t)}))).then((function(t){if(t)return(n=e,p("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:n})})).then((function(t){U.style.backgroundImage="url('".concat(t.avatar,"')")}));var n;console.error("Указанный URL-адрес не является допустимым.")}))}),t)}))})();